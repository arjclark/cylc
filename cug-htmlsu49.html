<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Job Submission, Ensemble Suites, And Network Timeouts</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- xhtml,3,next,html --> 
<meta name="src" content="cug-html.tex" /> 
<meta name="date" content="2012-08-03 00:47:00" /> 
<link rel="stylesheet" type="text/css" href="cug-html.css" /> 
</head><body 
>
   <!--l. 4569--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlsu50.html" >next</a>] [<a 
href="cug-htmlsu48.html" >prev</a>] [<a 
href="cug-htmlsu48.html#tailcug-htmlsu48.html" >prev-tail</a>] [<a 
href="#tailcug-htmlsu49.html">tail</a>] [<a 
href="cug-htmlse11.html#cug-htmlsu49.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">11.3   </span> <a 
 id="x74-14500011.3"></a>Job Submission, Ensemble Suites, And Network Timeouts</h4>
<!--l. 4572--><p class="noindent" >From a high level perspective cylc works like this: the scheduling algorithm determines which tasks, if any,
are ready to run; these tasks are submitted to run; then cylc processes network requests (running
tasks reporting state changes back to the suite, for instance) before repeating the whole process. Prior
to cylc-4.5.1 any tasks ready at the same time were submitted sequentially and success or failure of
each job submission subprocess was checked before continuing to the next one. For ensemble suites in
which a large number of tasks are submitted at once this could take quite some time, especially if
submitting jobs to a remote host, and cylc was unable to respond to network requests during this period
(the control GUI was likewise unable to obtain information from the suite until the job submissions
completed). This created a problem when network connection timeouts were introduced in cylc-4.5.0:
submitting many tasks at once, in sequence, could take quite some time and the earlier tasks to begin
running (while others in the same batch were still being submitted) could fail because of messaging
timeouts.
</p><!--l. 4589--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">11.3.1   </span> <a 
 id="x74-14600011.3.1"></a>Parallel Submission Of Jobs Ready At The Same Time</h5>
<!--l. 4591--><p class="noindent" >From cylc-4.5.1 all tasks ready at the same time can be submitted at once, or rather - to avoid swamping the host
system as each job submission occurs in its own spawned subprocess - in batches whose members are submitted in
parallel. The default batch size of 50 can be overridden in suite definitions: </p><!--l. 4595--><div class="lstlisting">
<span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x74-146001r1"></a></span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">SUITE</span><span 
class="pcrro7t-">.</span><span 
class="pcrro7t-">RC</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x74-146002r2"></a></span><span 
class="pcrr7t-">[</span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">]</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">maximum</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">number</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">of</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">simultaneous</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">submissions</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">50</span>


   </div>
<!--l. 4598--><p class="indent" >   A 120 task ensemble, for example, would be submitted in two batches of 50 followed by one of 20, with cylc
waiting on all member job submissions to return before going on to the next batch. Note that are waiting on the <span 
class="cmti-10">job</span>
<span 
class="cmti-10">submission command </span>to return here, not the submitted job. Typically local job submission will take a small
fraction of a second, but for remote tasks it may take on the order of a second to open the ssh tunnel,
create remote log directories if necessary, transmit the task job script over, and run the remote job
submission.
</p><!--l. 4607--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">11.3.2   </span> <a 
 id="x74-14700011.3.2"></a>Network Connection Timeouts</h5>
<!--l. 4609--><p class="noindent" >Parallel job submission greatly reduces the amount of time during which cylc cannot respond to network requests
when running large ensemble suites, but to be safe we have reverted to setting no network connection timeout by
default. A timeout can be configured in the suite definition if you like though (in which case it applies to
connections initiated by the suite&#8217;s tasks) or on the command line (to override a suite timeout for
suite start-up commands, and for one-off connections by user-invoked suite-connecting commands).
The downside of setting no connection timeout is that certain exceptional conditions can result in
connection processes hanging indefinitely (to see this try hitting Ctrl-Z to stop a running suite and then
attempting a <span class="lstinline"><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">scan</span></span> or <span class="lstinline"><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">dump</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">SUITE</span></span>, for instance, first with no timeout then using the
<span class="lstinline"><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">t</span><span 
class="pcrr7t-">,--</span><span 
class="pcrr7t-">timeout</span><span 
class="pcrr7t-">=</span></span> command option to set one). The downside of having a timeout set is that you have to
                                                                                         

                                                                                         
ensure it is long enough to handle the legitimate communication delays experienced when cylc is in
the dependency negotation and job submission sections of its main loop. It is probably sensible not
to set a timeout and just be aware of what the likely cause is if you do occasionally strike a hung
port.
                                                                                         

                                                                                         
</p>
   <!--l. 4630--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlsu50.html" >next</a>] [<a 
href="cug-htmlsu48.html" >prev</a>] [<a 
href="cug-htmlsu48.html#tailcug-htmlsu48.html" >prev-tail</a>] [<a 
href="cug-htmlsu49.html" >front</a>] [<a 
href="cug-htmlse11.html#cug-htmlsu49.html" >up</a>] </p></div>
<!--l. 4630--><p class="indent" >   <a 
 id="tailcug-htmlsu49.html"></a>  </p> 
</body></html> 
